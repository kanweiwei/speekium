# ğŸš€ Speekium å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼

å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è®© Speekium å®ç°**é—ªç”µèˆ¬çš„å“åº”é€Ÿåº¦** âš¡

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | é¦–æ¬¡å“åº” | åç»­å“åº” | å†…å­˜å ç”¨ | ä¼˜åŠ¿ |
|------|---------|---------|---------|------|
| **æ—§æ¨¡å¼** | ~3.5s | ~3.5s | åŠ¨æ€ | ç®€å• |
| **å®ˆæŠ¤è¿›ç¨‹** | ~3.5s | **~0.2s** | ~500MB | **å¿« 18 å€ï¼** |

## ğŸ¯ ä»€ä¹ˆæ˜¯å®ˆæŠ¤è¿›ç¨‹ï¼Ÿ

å®ˆæŠ¤è¿›ç¨‹ = åå°æŒç»­è¿è¡Œçš„ç¨‹åº

**å·¥ä½œåŸç†**ï¼š
```
å¯åŠ¨æ—¶ï¼šåŠ è½½ä¸€æ¬¡æ‰€æœ‰æ¨¡å‹ï¼ˆVAD + ASR + LLMï¼‰
ä½¿ç”¨æ—¶ï¼šæ¨¡å‹å·²å°±ç»ªï¼Œç«‹åˆ»å“åº” âš¡
é€€å‡ºæ—¶ï¼šè‡ªåŠ¨æ¸…ç†ï¼Œä¸ç•™ç—•è¿¹
```

## ğŸ—ï¸ æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Tauri Desktop App (Rust)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  UI     â”‚  â”‚ Shortcuts â”‚  â”‚  Tray  â”‚ â”‚
â”‚  â”‚ (React) â”‚  â”‚  Handler  â”‚  â”‚  Icon  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚             â”‚            â”‚      â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                     â”‚                   â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚          â”‚  Daemon Manager     â”‚        â”‚
â”‚          â”‚  (stdin/stdout IPC) â”‚        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ JSON å‘½ä»¤
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Python Daemon Process    â”‚
        â”‚                            â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  é¢„åŠ è½½æ¨¡å‹ï¼ˆå¸¸é©»ï¼‰   â”‚  â”‚
        â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
        â”‚  â”‚ â€¢ VAD (Silero)       â”‚  â”‚
        â”‚  â”‚ â€¢ ASR (SenseVoice)   â”‚  â”‚
        â”‚  â”‚ â€¢ LLM (Ollama/Claude)â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â”‚                            â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
        â”‚  â”‚  å‘½ä»¤å¤„ç†å™¨           â”‚  â”‚
        â”‚  â”‚ â€¢ record            â”‚  â”‚
        â”‚  â”‚ â€¢ chat              â”‚  â”‚
        â”‚  â”‚ â€¢ tts               â”‚  â”‚
        â”‚  â”‚ â€¢ health            â”‚  â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‚ æ–°å¢æ–‡ä»¶

```
speekium/
â”œâ”€â”€ worker_daemon.py         # å®ˆæŠ¤è¿›ç¨‹ä¸»ç¨‹åº â­ æ–°å¢
â”œâ”€â”€ test_daemon.py          # å®ˆæŠ¤è¿›ç¨‹æµ‹è¯•è„šæœ¬ â­ æ–°å¢
â”œâ”€â”€ start-tauri.sh          # ç®€åŒ–å¯åŠ¨è„šæœ¬ â­ æ–°å¢
â””â”€â”€ tauri-prototype/
    â””â”€â”€ src-tauri/
        â””â”€â”€ src/
            â””â”€â”€ lib.rs      # é‡å†™ï¼Œæ”¯æŒå®ˆæŠ¤è¿›ç¨‹ âœ… å·²æ›´æ–°
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ 1ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
./start-tauri.sh
```

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# 1. æ¿€æ´» Python ç¯å¢ƒ
source .venv/bin/activate

# 2. è¿›å…¥ Tauri ç›®å½•
cd tauri-prototype

# 3. å¯åŠ¨åº”ç”¨
npm run tauri dev
```

## ğŸ§ª æµ‹è¯•å®ˆæŠ¤è¿›ç¨‹

ç‹¬ç«‹æµ‹è¯• Python å®ˆæŠ¤è¿›ç¨‹ï¼š

```bash
python3 test_daemon.py
```

**æµ‹è¯•å†…å®¹**ï¼š
1. å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹
2. å¥åº·æ£€æŸ¥
3. é…ç½®åŠ è½½
4. TTS ç”Ÿæˆ
5. LLM å¯¹è¯
6. æ€§èƒ½æµ‹è¯•ï¼ˆ10æ¬¡å¥åº·æ£€æŸ¥ï¼‰
7. é€€å‡ºå‘½ä»¤

**é¢„æœŸç»“æœ**ï¼š
```
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
ğŸ“Š å¹³å‡å“åº”æ—¶é—´: ~50ms
âš¡ æœ€å¿«: ~20ms
ğŸŒ æœ€æ…¢: ~100ms
```

## ğŸ” å·¥ä½œæµç¨‹è¯¦è§£

### 1. åº”ç”¨å¯åŠ¨

```rust
// Tauri setup()
fn setup() {
    // å¯åŠ¨ Python å®ˆæŠ¤è¿›ç¨‹
    let mut child = Command::new("python3")
        .arg("worker_daemon.py")
        .arg("daemon")
        .stdin(Stdio::piped())
        .stdout(Stdio::piped())
        .spawn()?;

    // ç­‰å¾…æ¨¡å‹åŠ è½½ï¼ˆ~10ç§’ï¼‰
    // å®ˆæŠ¤è¿›ç¨‹è¿›å…¥å¾…å‘½çŠ¶æ€
}
```

### 2. ç”¨æˆ·å½•éŸ³

```rust
// ç”¨æˆ·ç‚¹å‡»"å½•éŸ³"æŒ‰é’®
#[tauri::command]
async fn record_audio(mode: String) -> RecordResult {
    // å‘å®ˆæŠ¤è¿›ç¨‹å‘é€å‘½ä»¤
    let request = json!({
        "command": "record",
        "args": {"mode": mode}
    });

    // å†™å…¥ stdin
    daemon.stdin.write(request);

    // ä» stdout è¯»å–ç»“æœï¼ˆ~0.2sï¼‰
    let result = daemon.stdout.readline();

    return result;  // å¿«ï¼
}
```

### 3. LLM å¯¹è¯

```rust
#[tauri::command]
async fn chat_llm(text: String) -> ChatResult {
    // åŒæ ·é€šè¿‡ stdin/stdout é€šä¿¡
    // å®ˆæŠ¤è¿›ç¨‹å·²åŠ è½½ LLMï¼Œç«‹åˆ»å“åº”
    call_daemon("chat", {"text": text})
}
```

### 4. åº”ç”¨é€€å‡º

```rust
// Tauri on_exit()
fn cleanup_daemon() {
    // å‘é€é€€å‡ºå‘½ä»¤
    daemon.send_command("exit", {});

    // ç­‰å¾…è¿›ç¨‹æ­£å¸¸é€€å‡º
    daemon.process.wait();
}
```

## ğŸ›¡ï¸ å¥åº·æ£€æŸ¥æœºåˆ¶

### Rust ç«¯

```rust
fn ensure_daemon_running() {
    if daemon.health_check() {
        return;  // å¥åº·ï¼Œç»§ç»­ä½¿ç”¨
    }

    // ä¸å¥åº·ï¼Œé‡å¯å®ˆæŠ¤è¿›ç¨‹
    daemon.kill();
    daemon = PythonDaemon::new();
}
```

### å‰ç«¯è‡ªåŠ¨æ£€æŸ¥

```typescript
// æ¯ 30 ç§’æ£€æŸ¥ä¸€æ¬¡
setInterval(() => {
    invoke('daemon_health')
}, 30000);
```

### Python å®ˆæŠ¤è¿›ç¨‹å“åº”

```python
def handle_health(self):
    return {
        "success": True,
        "status": "healthy",
        "command_count": 123,
        "models_loaded": {
            "vad": True,
            "asr": True,
            "llm": True
        }
    }
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–ç‚¹

### 1. æ¨¡å‹é¢„åŠ è½½

**æ—§æ¨¡å¼**ï¼šæ¯æ¬¡éƒ½åŠ è½½
```python
def record():
    vad = load_vad()      # 1s
    asr = load_asr()      # 1s
    llm = load_llm()      # 0.5s
    # å¤„ç†...
```

**å®ˆæŠ¤è¿›ç¨‹**ï¼šåªåŠ è½½ä¸€æ¬¡
```python
class Daemon:
    def __init__(self):
        self.vad = load_vad()  # å¯åŠ¨æ—¶åŠ è½½
        self.asr = load_asr()
        self.llm = load_llm()

    def record(self):
        # ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€åŠ è½½ï¼
        self.vad.detect(audio)
```

### 2. è¿›ç¨‹å¤ç”¨

**æ—§æ¨¡å¼**ï¼šå¯åŠ¨/å…³é—­å¼€é”€
```
å¯åŠ¨ Python è¿›ç¨‹: ~500ms
å¯¼å…¥æ¨¡å—: ~500ms
åŠ è½½æ¨¡å‹: ~2500ms
å¤„ç†è¯·æ±‚: ~200ms
å…³é—­è¿›ç¨‹: ~100ms
---
æ€»è®¡: ~3800ms
```

**å®ˆæŠ¤è¿›ç¨‹**ï¼šåªæœ‰å¤„ç†å¼€é”€
```
å¤„ç†è¯·æ±‚: ~200ms
---
æ€»è®¡: ~200ms (å¿« 19 å€ï¼)
```

### 3. stdin/stdout IPC

**ä¼˜åŠ¿**ï¼š
- é›¶ä¾èµ–ï¼ˆæ“ä½œç³»ç»ŸåŸç”Ÿæ”¯æŒï¼‰
- ä½å»¶è¿Ÿï¼ˆ~1msï¼‰
- ç®€å•å¯é 

**é€šä¿¡æ ¼å¼**ï¼š
```json
// è¯·æ±‚ (Rust â†’ Python via stdin)
{"command": "chat", "args": {"text": "hello"}}

// å“åº” (Python â†’ Rust via stdout)
{"success": true, "content": "ä½ å¥½ï¼"}
```

## âš™ï¸ é…ç½®

æ‰€æœ‰é…ç½®åœ¨ `speekium.py` ä¸­ï¼š

```python
# LLM åç«¯
LLM_BACKEND = "ollama"  # "claude" æˆ– "ollama"
OLLAMA_MODEL = "qwen2.5:1.5b"

# TTS åç«¯
TTS_BACKEND = "edge"  # "edge" æˆ– "piper"

# VAD å‚æ•°
VAD_THRESHOLD = 0.7  # è¯­éŸ³æ£€æµ‹é˜ˆå€¼
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šå®ˆæŠ¤è¿›ç¨‹å¯åŠ¨å¤±è´¥

```bash
# æ£€æŸ¥ Python ç¯å¢ƒ
source .venv/bin/activate
python3 worker_daemon.py daemon

# åº”è¯¥çœ‹åˆ°ï¼š
# [Daemon] ğŸš€ Speekium Daemon åˆå§‹åŒ–ä¸­...
# [Daemon] âœ… æ‰€æœ‰æ¨¡å‹åŠ è½½å®Œæˆ
```

### é—®é¢˜ 2ï¼šå¥åº·æ£€æŸ¥å¤±è´¥

```bash
# æµ‹è¯•å®ˆæŠ¤è¿›ç¨‹
python3 test_daemon.py

# æŸ¥çœ‹è¾“å‡ºï¼Œå®šä½é—®é¢˜
```

### é—®é¢˜ 3ï¼šå“åº”æ…¢

**å¯èƒ½åŸå› **ï¼š
- Python ç¯å¢ƒæœªæ¿€æ´»
- æ¨¡å‹åŠ è½½å¤±è´¥
- LLM åç«¯ï¼ˆOllamaï¼‰æœªå¯åŠ¨

**æ£€æŸ¥æ–¹æ³•**ï¼š
```bash
# æŸ¥çœ‹å®ˆæŠ¤è¿›ç¨‹æ—¥å¿—
# (Tauri å¯åŠ¨æ—¶ä¼šè¾“å‡ºåˆ°ç»ˆç«¯)

# ç¡®è®¤ Ollama è¿è¡Œ
curl http://localhost:11434

# æµ‹è¯•å•ç‹¬çš„å®ˆæŠ¤è¿›ç¨‹æ€§èƒ½
python3 test_daemon.py
```

## ğŸ“ˆ åç»­ä¼˜åŒ–

### é˜¶æ®µ 2ï¼šæµå¼å“åº”ï¼ˆè§„åˆ’ä¸­ï¼‰

```rust
// LLM æµå¼è¾“å‡º
async fn chat_stream(text: String) {
    // å®ˆæŠ¤è¿›ç¨‹è¿”å›æµå¼æ•°æ®
    while let Some(chunk) = daemon.read_chunk() {
        window.emit("chat-chunk", chunk);
    }
}
```

### é˜¶æ®µ 3ï¼šWebSocket æ¨¡å¼ï¼ˆå¯é€‰ï¼‰

æ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼Œä½†å¢åŠ å¤æ‚åº¦ã€‚

## ğŸ“ æ€»ç»“

å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å¸¦æ¥çš„æ”¹è¿›ï¼š

âœ… **æ€§èƒ½æå‡ 18 å€**ï¼ˆåç»­å“åº”ä» 3.5s â†’ 0.2sï¼‰
âœ… **ç”¨æˆ·ä½“éªŒæ›´æµç•…**ï¼ˆå‡ ä¹æ— ç­‰å¾…ï¼‰
âœ… **è‡ªåŠ¨å¥åº·æ£€æŸ¥**ï¼ˆå´©æºƒè‡ªåŠ¨é‡å¯ï¼‰
âœ… **ä¼˜é›…é€€å‡º**ï¼ˆèµ„æºæ¸…ç†å®Œæ•´ï¼‰
âœ… **ç®€å•å¯é **ï¼ˆstdin/stdout IPCï¼‰

---

**äº«å—é—ªç”µèˆ¬çš„ Speekium ä½“éªŒï¼** âš¡
