# Speekium UI 重设计方案

**设计时间**: 2026-01-07
**设计风格**: 极简科技 + AI对话界面
**技术栈**: React + TypeScript + Tailwind CSS + Radix UI + pywebview

---

## 一、整体架构

### 1.1 窗口系统
```
应用启动
    ├─ 主窗口 (1200x800, 可调整大小)
    ├─ 悬浮窗 (240x100, 无边框, 置顶)
    └─ 系统托盘
```

### 1.2 运行模式
- **按键录音模式**: Ctrl/Cmd + Alt + Space 按住录音，松开发送
- **自由对话模式**: 自动VAD检测，持续监听对话

---

## 二、主窗口设计

### 2.1 布局结构
```
┌─────────────────────────────────────────────┐
│  标题栏 (系统原生)                           │
├────────┬────────────────────────────────────┤
│        │  顶部状态栏                         │
│  导航  │  ├─ 当前模式图标                    │
│  栏    │  ├─ 监听状态                        │
│        │  └─ LLM/TTS 后端                   │
│  🏠    ├────────────────────────────────────┤
│  主页  │                                     │
│        │  对话历史区域                       │
│  ⚙️    │  (按日期分组，自动滚动)             │
│  设置  │                                     │
│        │                                     │
│  ℹ️    │                                     │
│  关于  │                                     │
│        │                                     │
└────────┴────────────────────────────────────┘
```

### 2.2 左侧导航 (宽度: 180px)
- **主页** 🏠: 对话界面 (默认)
- **设置** ⚙️: 打开设置弹窗
- **关于** ℹ️: 应用信息、版本号

### 2.3 顶部状态栏 (高度: 60px)
```
┌─────────────────────────────────────────────┐
│  🎤 按键录音   │  💬 10条对话  │  🤖 Ollama  │
└─────────────────────────────────────────────┘
```
- 左侧: 当前模式 (按键录音 / 自由对话)
- 中间: 对话统计
- 右侧: 当前后端 (Claude / Ollama)

### 2.4 对话历史
- **时间显示**: 相对时间 (刚才、5分钟前、今天 14:30)
- **日期分组**: TODAY / YESTERDAY / 2026-01-05
- **消息气泡**:
  - 用户: 右侧，蓝色/绿色渐变
  - AI: 左侧，灰色背景
  - 支持多行文本、Markdown渲染
- **操作**: 每条消息悬停显示复制按钮

---

## 三、悬浮窗设计

### 3.1 窗口特性
- **尺寸**: 240px × 100px (固定)
- **位置**: 屏幕底部居中，距离底部 80px
- **样式**: 无边框 (frameless)、置顶 (on_top)、圆角
- **背景**: 玻璃态半透明 (backdrop-blur + 20% opacity)

### 3.2 内容布局
```
┏━━━━━━━━━━━━━━━━━━━━━━━┓
┃       🎤 录音中...      ┃
┃                         ┃
┃     ▂▃▅▆▇▆▅▃▂         ┃
┃                         ┃
┗━━━━━━━━━━━━━━━━━━━━━━━┛
```
- 顶部: 状态文字 (录音中 / 识别中)
- 中央: 实时音频波形动画
- 颜色: 跟随主题 (深色模式用亮色波形，浅色模式用深色波形)

### 3.3 显示逻辑
```
按键模式:
  按下 Ctrl+Alt+Space → 显示悬浮窗 → 开始录音
  松开按键 → 停止录音 → 隐藏悬浮窗

自由对话模式:
  VAD检测到语音 → 显示悬浮窗 → 录音中
  语音结束 → 识别中 (1-2秒) → 隐藏悬浮窗
```

---

## 四、系统托盘

### 4.1 托盘图标
- 使用应用图标
- 监听状态时添加小圆点指示器

### 4.2 托盘菜单
```
┌─────────────────────┐
│ 📱 显示主窗口        │
├─────────────────────┤
│ 🎤 按键录音模式      │ ← 当前选中
│ 💬 自由对话模式      │
├─────────────────────┤
│ ▶️ 开始监听          │
│ ⏸️ 停止监听          │
├─────────────────────┤
│ 🗑️ 清空对话历史      │
│ ⚙️ 设置              │
├─────────────────────┤
│ ❌ 退出应用          │
└─────────────────────┘
```

---

## 五、设置面板

### 5.1 展示方式
- 弹窗式 Dialog (覆盖主窗口)
- 尺寸: 600px × 700px
- 垂直滚动，支持搜索配置项

### 5.2 配置分组

#### 基础配置
- **LLM 后端**: Claude / Ollama / (未来: OpenAI)
- **Ollama 模型**: qwen2.5:1.5b / llama3 / ...
- **Ollama URL**: http://localhost:11434
- **TTS 后端**: Edge TTS / Piper / (未来: 本地TTS)
- **TTS 语速**: -50% ~ +100% (滑块)

#### 语音配置
- **VAD 阈值**: 0.1 ~ 1.0 (滑块，默认 0.7)
- **最小语音时长**: 0.5s ~ 5s (默认 1s)
- **静音超时**: 1s ~ 10s (默认 2s)

#### 对话配置
- **对话历史条数**: 5 ~ 100 (默认 10)
- **自动保存对话**: 开/关
- **对话导出格式**: JSON / Markdown / TXT

#### 界面配置
- **主题**: 浅色 / 深色 / 跟随系统
- **语言**: 中文 / English
- **启动时显示主窗口**: 开/关

#### 快捷键配置
- **按键录音**: Ctrl/Cmd + Alt + Space (可自定义)
- **显示主窗口**: 可自定义
- **停止对话**: Esc

#### 高级配置
- **开发者模式**: 开/关 (显示日志、API 调用详情)
- **日志级别**: DEBUG / INFO / WARNING / ERROR

---

## 六、主题系统

### 6.1 深色主题
```css
--background: #0a0a0a
--foreground: #ededed
--card: #1a1a1a
--card-foreground: #fafafa
--primary: #3b82f6
--muted: #3f3f46
--border: #27272a
```

### 6.2 浅色主题
```css
--background: #ffffff
--foreground: #0a0a0a
--card: #f4f4f5
--card-foreground: #18181b
--primary: #2563eb
--muted: #f4f4f5
--border: #e4e4e7
```

### 6.3 渐变色
- 用户消息气泡: `bg-gradient-to-br from-blue-500 to-blue-600`
- 悬浮窗背景: `bg-black/20 dark:bg-white/10 backdrop-blur-xl`

---

## 七、技术实现要点

### 7.1 Python 后端新增
```python
# web_app.py 扩展

class ModeManager:
    """录音模式管理"""
    - push_to_talk_mode()  # 按键录音
    - continuous_mode()    # 自由对话
    - switch_mode()

class HotkeyManager:
    """全局快捷键监听 (使用 pynput)"""
    - register_hotkey()
    - on_press()
    - on_release()

class FloatingWindow:
    """悬浮窗管理"""
    - create_window()
    - show()
    - hide()
    - update_waveform()

class TrayIcon:
    """系统托盘 (使用 pystray)"""
    - create_tray()
    - build_menu()
    - on_tray_click()
```

### 7.2 前端新增
```typescript
// 主题系统
hooks/useTheme.ts         // 主题切换逻辑
components/ThemeProvider.tsx

// 新组件
components/StatusBar.tsx   // 顶部状态栏
components/Sidebar.tsx     // 左侧导航
components/MessageList.tsx // 对话历史列表
components/FloatingWaveform.tsx // 悬浮窗波形

// 悬浮窗独立入口
floating.html
FloatingApp.tsx
```

---

## 八、实施计划

### Phase 1: Python 后端 (1-2天)
1. 模式切换功能
2. 全局快捷键监听 (pynput)
3. 悬浮窗管理器
4. 系统托盘集成 (pystray)

### Phase 2: 前端重构 (2-3天)
1. 主题系统
2. 新布局组件
3. 状态管理优化
4. 悬浮窗界面

### Phase 3: 集成测试 (1天)
1. 多窗口协调
2. 快捷键冲突处理
3. 性能优化
4. 跨平台测试

---

## 九、兼容性

### 9.1 平台支持
- ✅ macOS (主要测试平台)
- ✅ Windows (pystray 支持)
- ⚠️ Linux (部分功能可能受限)

### 9.2 依赖库
```
新增依赖:
- pynput==1.7.6        # 全局快捷键
- pystray==0.19.5      # 系统托盘
- Pillow==10.2.0       # 托盘图标
```

---

## 十、未来扩展

- [ ] 多语言本地化 (i18n)
- [ ] 对话导出和导入
- [ ] 语音情感分析可视化
- [ ] 插件系统
- [ ] 云同步对话历史
