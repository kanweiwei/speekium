# Speekium Tauri 测试指南

## 🎯 测试目标

验证新架构（Tauri Invoke）的所有功能是否正常工作。

## ✅ 当前状态

**Tauri 应用**: ✅ 正在运行
- Vite: http://localhost:1420/
- 全局快捷键: Command+Shift+Space ✅
- 配置加载: 成功 ✅

## 📋 测试清单

### 1. 基础功能测试

#### 1.1 应用启动 ✅
- [x] Tauri 窗口打开
- [x] UI 界面正常显示
- [x] 配置加载成功

#### 1.2 系统集成 ✅
- [x] 系统托盘图标显示
- [x] 托盘图标透明（无白色背景）
- [ ] 点击托盘图标显示/隐藏窗口
- [x] 全局快捷键注册成功 (Command+Shift+Space)
- [ ] 按快捷键显示/隐藏窗口

### 2. 核心功能测试

#### 2.1 录音功能 ⏳ 待测试
**测试步骤**:
1. 点击 🎤 录音按钮
2. **立即开始说话**（3 秒内）
3. 观察识别结果

**预期结果**:
- ✅ 界面流畅，无闪烁
- ✅ 3 秒后自动停止
- ✅ 显示识别文本
- ✅ 显示识别语言

**可能的问题**:
- 麦克风权限未授予
- Python 依赖未安装
- SenseVoice 模型未下载

#### 2.2 LLM 对话 ⏳ 待测试
**前置条件**: 录音成功

**测试步骤**:
1. 等待录音识别完成
2. 观察 LLM 响应

**预期结果**:
- ✅ 识别文本自动发送到 LLM
- ✅ LLM 响应显示在对话框中
- ✅ 响应流畅，无阻塞

**可能的问题**:
- Ollama 服务未启动
- 模型未下载 (qwen2.5:1.5b)

#### 2.3 TTS 播放 ⏳ 待测试
**前置条件**: LLM 响应成功 + 自动播放已启用

**测试步骤**:
1. 等待 LLM 响应
2. 观察是否自动播放语音

**预期结果**:
- ✅ 自动生成 TTS 音频
- ✅ 自动播放语音
- ✅ 播放完成后状态恢复

#### 2.4 录音模式切换 ⏳ 待测试
**测试步骤**:
1. 在设置中切换录音模式
2. 测试不同模式的录音

**录音模式**:
- **按键录音**: 点击后立即录音 3 秒
- **自动检测**: VAD 检测到语音后开始

**预期结果**:
- ✅ 模式切换正常
- ✅ 两种模式都能正常录音

### 3. 架构验证

#### 3.1 通信方式 ✅ 已验证
- [x] 使用 Tauri invoke（非 HTTP）
- [x] Python 作为子进程运行
- [x] 无需单独启动 backend_server.py

#### 3.2 性能验证 ⏳ 待测试
**测试项目**:
- [ ] 录音响应延迟 < 100ms
- [ ] LLM 调用响应 < 3s
- [ ] 界面无闪烁
- [ ] 内存占用 < 100MB

## 🔧 问题排查

### 录音失败

**检查 1: 麦克风权限**
```bash
python3 -c "import sounddevice as sd; print(sd.query_devices())"
```

**解决方案**:
- 系统设置 → 隐私与安全性 → 麦克风
- 勾选 Terminal/iTerm/Python

**检查 2: Python 依赖**
```bash
cd /Users/kww/work/opensource/speekium
uv sync
```

**检查 3: SenseVoice 模型**
- 首次使用会自动下载
- 下载路径: `~/.cache/modelscope/hub/models/iic/SenseVoiceSmall`

### LLM 失败

**检查 1: Ollama 服务**
```bash
# 查看服务状态
ps aux | grep ollama

# 启动服务
ollama serve
```

**检查 2: 模型下载**
```bash
# 查看已下载模型
ollama list

# 下载模型（如果缺失）
ollama pull qwen2.5:1.5b
```

**检查 3: API 连接**
```bash
curl http://localhost:11434/api/tags
```

### TTS 失败

**检查: Edge-TTS 安装**
```bash
python3 -c "import edge_tts; print('✓ Edge-TTS installed')"
```

**解决方案**:
```bash
uv add edge-tts
# 或
pip install edge-tts
```

## 📊 测试记录

### 测试环境
- **系统**: macOS (Darwin 24.6.0)
- **Node.js**: v22.21.1
- **Python**: 3.10+
- **Rust**: 最新稳定版
- **Tauri**: 2.9.5

### 测试结果

| 功能 | 状态 | 备注 |
|------|------|------|
| 应用启动 | ✅ | 正常 |
| 配置加载 | ✅ | 成功 4 次 |
| 托盘图标 | ✅ | 透明显示 |
| 全局快捷键 | ✅ | 已注册 |
| 录音功能 | ⏳ | 待测试 |
| LLM 对话 | ⏳ | 待测试 |
| TTS 播放 | ⏳ | 待测试 |
| 界面流畅性 | ⏳ | 待验证 |

### Python Worker 单独测试

| 命令 | 状态 | 结果 |
|------|------|------|
| `worker.py config` | ✅ | LLM: ollama, TTS: edge |
| `worker.py chat '{"text":"你好"}'` | ✅ | "你好！有什么可以帮助你的吗？" |
| `worker.py tts '{"text":"测试"}'` | ✅ | 音频文件已生成 |
| `worker.py record` | ⏳ | 需要麦克风输入 |

## ✨ 预期体验

### 旧架构（HTTP）vs 新架构（Invoke）

**录音体验**:
- ❌ 旧：点击按钮 → 等待 3 秒（界面冻结、闪烁）→ 显示结果
- ✅ 新：点击按钮 → 流畅录音 3 秒（界面流畅）→ 显示结果

**启动体验**:
- ❌ 旧：启动 Python server → 启动 Tauri（2 步）
- ✅ 新：启动 Tauri（1 步）

**调试体验**:
- ❌ 旧：需要查看 2 个终端（Python + Tauri）
- ✅ 新：只需查看 1 个终端（Tauri，包含 Python stderr）

## 📝 测试报告模板

```markdown
## 测试日期: YYYY-MM-DD

### 环境信息
- 系统:
- Node.js:
- Python:
- Ollama:

### 测试结果
- [ ] 录音功能
- [ ] LLM 对话
- [ ] TTS 播放
- [ ] 界面流畅性
- [ ] 内存占用

### 发现的问题
1.
2.

### 性能数据
- 录音响应: __ms
- LLM 响应: __s
- 内存占用: __MB
```

## 🎯 验收标准

### 必须通过（P0）
- ✅ 应用正常启动
- ✅ 配置正常加载
- ⏳ 录音功能正常
- ⏳ 识别结果准确
- ⏳ LLM 对话正常
- ⏳ 界面流畅无闪烁

### 应该通过（P1）
- ⏳ TTS 播放正常
- ⏳ 两种录音模式都可用
- ⏳ 全局快捷键正常
- ⏳ 系统托盘正常

### 可选通过（P2）
- 内存占用 < 100MB
- 录音响应 < 100ms
- LLM 响应 < 3s

---

**下一步**: 在 Tauri 窗口中执行测试清单，验证所有功能
