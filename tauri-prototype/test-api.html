<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speekium API æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        button.recording {
            background: #f44336;
        }
        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .message {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .message.user {
            background: #1976D2;
        }
        .message.assistant {
            background: #388E3C;
        }
        .status {
            padding: 5px 10px;
            background: #333;
            border-radius: 4px;
            display: inline-block;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤ Speekium API æµ‹è¯•</h1>

    <div class="test-section">
        <h2>1. åç«¯å¥åº·æ£€æŸ¥</h2>
        <button onclick="testHealth()">æµ‹è¯•å¥åº·ç«¯ç‚¹</button>
        <pre id="health-result">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
        <h2>2. é…ç½®åŠ è½½æµ‹è¯•</h2>
        <button onclick="testConfig()">åŠ è½½é…ç½®</button>
        <pre id="config-result">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
        <h2>3. èŠå¤©æµ‹è¯•ï¼ˆä¸éœ€è¦å½•éŸ³ï¼‰</h2>
        <input type="text" id="chat-input" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯" style="width: 300px; padding: 8px;">
        <button onclick="testChat()">å‘é€æ¶ˆæ¯</button>
        <div class="status">çŠ¶æ€: <span id="chat-status">å°±ç»ª</span></div>
        <div id="chat-messages"></div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8008';

        async function testHealth() {
            try {
                const response = await fetch(`${API_BASE}/health`);
                const text = await response.text();
                document.getElementById('health-result').textContent =
                    `çŠ¶æ€: ${response.status}\nå“åº”: ${text}`;
            } catch (error) {
                document.getElementById('health-result').textContent =
                    `é”™è¯¯: ${error.message}`;
            }
        }

        async function testConfig() {
            try {
                const response = await fetch(`${API_BASE}/api/config`);
                const data = await response.json();
                document.getElementById('config-result').textContent =
                    JSON.stringify(data, null, 2);
            } catch (error) {
                document.getElementById('config-result').textContent =
                    `é”™è¯¯: ${error.message}`;
            }
        }

        async function testChat() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) {
                alert('è¯·è¾“å…¥æ¶ˆæ¯');
                return;
            }

            const statusEl = document.getElementById('chat-status');
            const messagesEl = document.getElementById('chat-messages');

            try {
                statusEl.textContent = 'å‘é€ä¸­...';

                // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                const userMsg = document.createElement('div');
                userMsg.className = 'message user';
                userMsg.textContent = `ç”¨æˆ·: ${text}`;
                messagesEl.appendChild(userMsg);

                const response = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });

                const data = await response.json();
                console.log('Chat response:', data);

                // å¤„ç†å“åº”
                if (Array.isArray(data)) {
                    data.forEach(chunk => {
                        if (chunk.type === 'text' && chunk.content) {
                            const assistantMsg = document.createElement('div');
                            assistantMsg.className = 'message assistant';
                            assistantMsg.textContent = `åŠ©æ‰‹: ${chunk.content}`;
                            messagesEl.appendChild(assistantMsg);
                        } else if (chunk.type === 'error') {
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'message';
                            errorMsg.style.background = '#f44336';
                            errorMsg.textContent = `é”™è¯¯: ${chunk.error}`;
                            messagesEl.appendChild(errorMsg);
                        }
                    });
                }

                statusEl.textContent = 'å°±ç»ª';
                input.value = '';
            } catch (error) {
                statusEl.textContent = `é”™è¯¯: ${error.message}`;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¥åº·å’Œé…ç½®
        window.onload = () => {
            testHealth();
            setTimeout(testConfig, 500);
        };
    </script>
</body>
</html>
