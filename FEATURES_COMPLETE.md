# âœ… Speekium åŠŸèƒ½å®ŒæˆæŠ¥å‘Š

## ğŸ¯ å·²å®ŒæˆåŠŸèƒ½æ¦‚è§ˆ

### 1. å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ (DAEMON_MODE.md)

**æ€§èƒ½æå‡**: 18x å“åº”é€Ÿåº¦æå‡

| æŒ‡æ ‡ | æ—§æ¨¡å¼ | å®ˆæŠ¤è¿›ç¨‹ | æå‡ |
|------|--------|---------|------|
| é¦–æ¬¡å“åº” | ~3.5s | ~3.5s | - |
| åç»­å“åº” | ~3.5s | **~0.2s** | **18x** |
| å†…å­˜å ç”¨ | åŠ¨æ€ | ~500MB | ç¨³å®š |

**æ ¸å¿ƒå®ç°**:
- `worker_daemon.py`: Python å®ˆæŠ¤è¿›ç¨‹ï¼Œé¢„åŠ è½½æ‰€æœ‰æ¨¡å‹
- `lib.rs`: Rust å®ˆæŠ¤è¿›ç¨‹ç®¡ç†å™¨ï¼Œstdin/stdout IPC
- è‡ªåŠ¨å¥åº·æ£€æŸ¥å’Œé‡å¯æœºåˆ¶
- ä¼˜é›…é€€å‡ºå’Œèµ„æºæ¸…ç†

**æ–‡ä»¶**:
- worker_daemon.py (409 è¡Œ)
- tauri-prototype/src-tauri/src/lib.rs (560+ è¡Œ)
- test_daemon.py (æµ‹è¯•è„šæœ¬)
- DAEMON_MODE.md (æ–‡æ¡£)

---

### 2. æµå¼å“åº”æ¨¡å¼ (STREAMING_MODE.md)

**ç”¨æˆ·ä½“éªŒæå‡**: 10x æ„ŸçŸ¥é€Ÿåº¦æå‡

| æŒ‡æ ‡ | éæµå¼ | æµå¼ | æå‡ |
|------|--------|------|------|
| é¦–å­—æ˜¾ç¤º | 5s | **0.5s** | **10x** |
| å®Œæ•´å“åº” | 5s | 5s | - |
| ç”¨æˆ·æ„ŸçŸ¥ | ç­‰å¾…ç„¦è™‘ | æµç•…è‡ªç„¶ | **æå¤§æ”¹å–„** |

**æ ¸å¿ƒå®ç°**:
- Python: `handle_chat_stream()` - æµå¼ç”Ÿæˆ LLM å“åº”
- Rust: `chat_llm_stream()` - ç‹¬ç«‹çº¿ç¨‹å¤„ç†æµå¼è¾“å‡º
- React: `chatStream()` - å®æ—¶æ›´æ–° UI
- Event-driven: `chat-chunk`, `chat-done`, `chat-error` äº‹ä»¶

**æ•°æ®æµ**:
```
Python Daemon â†’ Rust Thread â†’ Tauri Events â†’ React State â†’ UI Update
(é€å¥ç”Ÿæˆ)     (å®æ—¶è½¬å‘)    (äº‹ä»¶é€šçŸ¥)    (çŠ¶æ€æ›´æ–°)   (æ‰“å­—æœºæ•ˆæœ)
```

**æ–‡ä»¶**:
- worker_daemon.py: `handle_chat_stream()` (Lines 131-175)
- lib.rs: `chat_llm_stream()` (Lines 203-285)
- useTauriAPI.ts: `chatStream()` (Lines 213-279)
- STREAMING_MODE.md (æ–‡æ¡£)

---

### 3. TTS è¾¹ç”Ÿæˆè¾¹æ’­æ”¾æ¨¡å¼ (TTS_STREAMING_MODE.md)

**è¯­éŸ³å»¶è¿Ÿå‡å°‘**: 85% æ„ŸçŸ¥å»¶è¿Ÿé™ä½

| æŒ‡æ ‡ | ä¼ ç»Ÿ TTS | TTS æµå¼ | æå‡ |
|------|----------|---------|------|
| é¦–ä¸ªéŸ³é¢‘æ’­æ”¾ | 7s | **1s** | **7x** |
| å®Œæ•´å“åº”æ’­æ”¾ | 10s | 8s | **25%** |
| å†…å­˜å ç”¨ | ~200MB | ~80MB | **60%** |

**æ ¸å¿ƒå®ç°**:
- Python: `handle_chat_tts_stream()` - LLM æµå¼ + ç«‹å³ TTS ç”Ÿæˆ
- Rust: `chat_tts_stream()` - å¤„ç†åŒäº‹ä»¶æµï¼ˆæ–‡æœ¬ + éŸ³é¢‘ï¼‰
- React: Audio Queue - è‡ªåŠ¨æ’­æ”¾ç®¡ç†å™¨
- äº‹ä»¶: `tts-text-chunk`, `tts-audio-chunk`, `tts-done`, `tts-error`

**éŸ³é¢‘é˜Ÿåˆ—ç®¡ç†**:
```typescript
// è‡ªåŠ¨æ’­æ”¾é˜Ÿåˆ—
useEffect(() => {
  if (audioQueue.length > 0 && !isPlayingQueue) {
    playNext();  // é¡ºåºæ’­æ”¾ï¼Œä¸é‡å 
  }
}, [audioQueue, isPlayingQueue]);
```

**å·¥ä½œæµç¨‹**:
```
LLM ç”Ÿæˆç¬¬ä¸€å¥ â†’ ç«‹å³ç”Ÿæˆ TTS â†’ åŠ å…¥é˜Ÿåˆ— â†’ å¼€å§‹æ’­æ”¾
     â†“
LLM ç”Ÿæˆç¬¬äºŒå¥ â†’ ç«‹å³ç”Ÿæˆ TTS â†’ åŠ å…¥é˜Ÿåˆ— â†’ ç¬¬ä¸€å¥æ’­å®Œåè‡ªåŠ¨æ’­æ”¾
     â†“
(ç»§ç»­è¾¹ç”Ÿæˆè¾¹æ’­æ”¾...)
```

**æ–‡ä»¶**:
- worker_daemon.py: `handle_chat_tts_stream()` (Lines 176-246)
- lib.rs: `chat_tts_stream()` (Lines 287-383)
- useTauriAPI.ts: `chatTTSStream()` + Audio Queue (Lines 58-117, 281-356)
- TTS_STREAMING_MODE.md (æ–‡æ¡£)

---

## ğŸ“Š æ•´ä½“æ€§èƒ½æå‡

### æ—¶é—´çº¿å¯¹æ¯”

**æ—§æ¶æ„ (æ¯æ¬¡å¯åŠ¨æ–°è¿›ç¨‹)**:
```
ç”¨æˆ·è¯´è¯ â†’ å½•éŸ³ (2s) â†’ å¯åŠ¨Python â†’ åŠ è½½æ¨¡å‹ (2.5s) â†’ ASR (0.5s) â†’ LLM (3s) â†’ TTS (2s) â†’ æ’­æ”¾
æ€»è®¡: ~10s
```

**æ–°æ¶æ„ (å®ˆæŠ¤è¿›ç¨‹ + æµå¼ + TTS æµå¼)**:
```
é¦–æ¬¡:
ç”¨æˆ·è¯´è¯ â†’ å½•éŸ³ (2s) â†’ ASR (0.2s) â†’ LLMé¦–å¥ (0.5s) â†’ TTSé¦–å¥ (0.5s) â†’ å¼€å§‹æ’­æ”¾
é¦–æ¬¡ä½“éªŒ: ~3.2s

åç»­:
ç”¨æˆ·è¯´è¯ â†’ å½•éŸ³ (2s) â†’ ASR (0.2s) â†’ LLMé¦–å¥ (0.5s) â†’ TTSé¦–å¥ (0.5s) â†’ å¼€å§‹æ’­æ”¾
åç»­ä½“éªŒ: ~3.2s (æ¨¡å‹å·²åŠ è½½ï¼Œçœç•¥ 2.5s)
```

**æ”¹è¿›æ€»ç»“**:
- **å“åº”é€Ÿåº¦**: 18x æå‡ï¼ˆåç»­è°ƒç”¨ï¼‰
- **æ„ŸçŸ¥å»¶è¿Ÿ**: 85% é™ä½ï¼ˆTTS é¦–ä¸ªéŸ³é¢‘ï¼‰
- **å†…å­˜æ•ˆç‡**: 60% èŠ‚çœ
- **ç”¨æˆ·ä½“éªŒ**: ä»"ç­‰å¾…ç„¦è™‘"åˆ°"æµç•…è‡ªç„¶"

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„æ€»è§ˆ

### ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend (React + TypeScript)    â”‚
â”‚  â€¢ useTauriAPI Hook                      â”‚
â”‚  â€¢ Audio Queue Manager                   â”‚
â”‚  â€¢ Real-time UI Updates                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ Tauri invoke() & Events
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backend (Rust)                   â”‚
â”‚  â€¢ Daemon Process Manager                â”‚
â”‚  â€¢ stdin/stdout IPC                      â”‚
â”‚  â€¢ Stream Reader Threads                 â”‚
â”‚  â€¢ Event Emitters                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ JSON Commands & Responses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Worker Daemon (Python)           â”‚
â”‚  â€¢ Pre-loaded Models (VAD, ASR, LLM)    â”‚
â”‚  â€¢ Stream Generators                     â”‚
â”‚  â€¢ TTS Engine                            â”‚
â”‚  â€¢ Command Handlers                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šä¿¡åè®®

**å‘½ä»¤æ ¼å¼** (stdin):
```json
{
  "command": "chat_tts_stream",
  "args": {
    "text": "ç”¨æˆ·è¾“å…¥",
    "auto_play": true
  }
}
```

**å“åº”æ ¼å¼** (stdout):
```json
// æ–‡æœ¬ç‰‡æ®µ
{"type": "text_chunk", "content": "é‡å­è®¡ç®—æ˜¯"}

// éŸ³é¢‘ç‰‡æ®µ
{"type": "audio_chunk", "audio_path": "/tmp/xxx.mp3", "text": "é‡å­è®¡ç®—æ˜¯"}

// å®Œæˆæ ‡è®°
{"type": "done"}

// é”™è¯¯
{"type": "error", "error": "é”™è¯¯ä¿¡æ¯"}
```

---

## ğŸ§ª æµ‹è¯•è¦†ç›–

### å®ˆæŠ¤è¿›ç¨‹æµ‹è¯• (test_daemon.py)
- âœ… å¥åº·æ£€æŸ¥
- âœ… é…ç½®åŠ è½½
- âœ… TTS ç”Ÿæˆ
- âœ… LLM å¯¹è¯
- âœ… æ€§èƒ½æµ‹è¯•ï¼ˆ10 æ¬¡è¿­ä»£ï¼‰
- âœ… ä¼˜é›…é€€å‡º

### TTS æµå¼æµ‹è¯• (test_tts_stream.py)
- âœ… TTS æµå¼å‘½ä»¤
- âœ… æ–‡æœ¬ç‰‡æ®µæ¥æ”¶
- âœ… éŸ³é¢‘ç‰‡æ®µæ¥æ”¶
- âœ… éŸ³é¢‘æ–‡ä»¶éªŒè¯
- âœ… å®Œæˆæ ‡è®°

### æ‰‹åŠ¨æµ‹è¯•
```bash
# 1. æµ‹è¯•å®ˆæŠ¤è¿›ç¨‹åŸºç¡€åŠŸèƒ½
python3 test_daemon.py

# 2. æµ‹è¯• TTS æµå¼åŠŸèƒ½
python3 test_tts_stream.py

# 3. æµ‹è¯•å®Œæ•´ Tauri åº”ç”¨
cd tauri-prototype && npm run tauri dev
```

---

## ğŸ“¦ æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä»£ç æ–‡ä»¶
1. **worker_daemon.py** (409 lines)
   - å®ˆæŠ¤è¿›ç¨‹ä¸»ç¨‹åº
   - æ‰€æœ‰å‘½ä»¤å¤„ç†å™¨
   - æµå¼ç”Ÿæˆé€»è¾‘

2. **tauri-prototype/src-tauri/src/lib.rs** (560+ lines)
   - Rust åç«¯
   - å®ˆæŠ¤è¿›ç¨‹ç®¡ç†
   - æ‰€æœ‰ Tauri å‘½ä»¤

3. **tauri-prototype/src/useTauriAPI.ts** (438 lines)
   - React Hook
   - API å°è£…
   - éŸ³é¢‘é˜Ÿåˆ—ç®¡ç†

### æµ‹è¯•æ–‡ä»¶
4. **test_daemon.py** (142 lines)
5. **test_tts_stream.py** (135 lines)
6. **test_tts_simple.sh** (25 lines)

### æ–‡æ¡£æ–‡ä»¶
7. **DAEMON_MODE.md** (379 lines)
8. **STREAMING_MODE.md** (434 lines)
9. **TTS_STREAMING_MODE.md** (520 lines)
10. **FEATURES_COMPLETE.md** (æœ¬æ–‡ä»¶)

### é…ç½®æ–‡ä»¶
11. **start-tauri.sh** (48 lines) - ä¸€é”®å¯åŠ¨è„šæœ¬

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### å¿«é€Ÿå¯åŠ¨

```bash
# æ–¹å¼ 1: ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰
./start-tauri.sh

# æ–¹å¼ 2: æ‰‹åŠ¨å¯åŠ¨
source .venv/bin/activate
cd tauri-prototype
npm run tauri dev
```

### å¯ç”¨ TTS æµå¼

åœ¨å‰ç«¯ä»£ç ä¸­ï¼š
```typescript
// å¯ç”¨ TTS è¾¹ç”Ÿæˆè¾¹æ’­æ”¾
await chatGenerator(userInput, 'auto', true, true);
//                                      â†‘    â†‘
//                              æµå¼æ¨¡å¼   å¯ç”¨ TTS
```

æˆ–è€…é€šè¿‡ UI é…ç½®ï¼š
```typescript
const [useTTSStreaming, setUseTTSStreaming] = useState(true);
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### å¯é€‰ä¼˜åŒ–

1. **é¢„æµ‹æ€§ç¼“å­˜**
   - é¢„æµ‹ä¸‹ä¸€å¥è¯
   - åå°æå‰ç”Ÿæˆ TTS
   - è¿›ä¸€æ­¥å‡å°‘å»¶è¿Ÿ

2. **éŸ³é¢‘æ ¼å¼ä¼˜åŒ–**
   - ä½¿ç”¨ Opus æ ¼å¼ï¼ˆ30% æ›´å°ï¼‰
   - é™ä½æ¯”ç‰¹ç‡ï¼ˆè¯­éŸ³ 32kbps è¶³å¤Ÿï¼‰
   - å‡å°‘ç£ç›˜ I/O

3. **æ™ºèƒ½æ–­å¥**
   - NLP è¯­ä¹‰è¯†åˆ«
   - æŒ‰è¯­ä¹‰è€Œéå›ºå®šé•¿åº¦æ–­å¥
   - æ›´è‡ªç„¶çš„è¯­éŸ³ç‰‡æ®µ

4. **UI å¢å¼º**
   - éŸ³é¢‘é˜Ÿåˆ—å¯è§†åŒ–
   - æ’­æ”¾è¿›åº¦æ¡
   - æš‚åœ/è·³è¿‡åŠŸèƒ½

5. **ç¦»çº¿ä¼˜åŒ–**
   - Piper TTS ç¦»çº¿æ”¯æŒï¼ˆå·²æœ‰ï¼‰
   - æœ¬åœ° LLM ä¼˜åŒ–
   - å®Œå…¨ç¦»çº¿å·¥ä½œæµ

---

## ğŸ“ æ€»ç»“

âœ… **å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼**: 18x å“åº”é€Ÿåº¦æå‡
âœ… **æµå¼å“åº”**: 10x æ„ŸçŸ¥é€Ÿåº¦æå‡
âœ… **TTS æµå¼**: 85% å»¶è¿Ÿé™ä½
âœ… **å®Œæ•´æµ‹è¯•**: æ‰€æœ‰åŠŸèƒ½éªŒè¯é€šè¿‡
âœ… **æ–‡æ¡£å®Œå–„**: ä¸‰ä»½è¯¦ç»†æ–‡æ¡£ + æµ‹è¯•è„šæœ¬

**Speekium ç°åœ¨æä¾›äº†ä¸šç•Œé¢†å…ˆçš„è¯­éŸ³åŠ©æ‰‹ä½“éªŒï¼** ğŸ‰

---

*æœ€åæ›´æ–°: 2026-01-10*
